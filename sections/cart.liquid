{% capture header %}
<div class="px-4 w-full">
  <div :class="hasItems ? 'justify-between' : 'justify-end'" class="pt-3 flex items-start  w-full relative h-[160px] bg-bone-tint border-b border-current">
    <p class="medium-serif pt-[68px]" x-show="hasItems">
      Bag (<span class="contents" x-text="count">{{ cart.item_count }}</span>)
    </p>
    <button
      @click="close()"
      aria-label="Close bag"
      class="medium-serif leading-none"
    >
      (Close)
    </button>
  </div>
</div>
{% endcapture %}

{% capture items %}
<template x-for="(line, index) in cartLines" :key="line.key">
  {% render 'cart-line' %}
</template>
{% endcapture %}

{% capture cartCheckout %}
<div class="w-full relative">
  <a
    href="/checkout"
    aria-label="Checkout"
    rel="external"
    target="_blank"
    data-no-swup
    class="button"
  >
    <span class="block">Check out</span>
    <span class="block">â†’</span>
  </a>
</div>
{% endcapture %}

<div
  x-data="cart"
  @cart:toggle.window="toggle"
  @cart:add.window="addLines"
  @cart:update.window="updateLines"
  class="fixed top-0 left-0 w-full h-full z-50 lg:grid lg:grid-cols-20 lg:gap-3 lg:px-4 pointer-events-none"
  x-trap.inert.noscroll="visible"
>
  <script id="cart-data" type="application/json">
    {{ cart | json }}
  </script>
  <button
    aria-label="Close cart"
    @click="close()"
    :class="
      {
        'opacity-0': !visible,
        'pointer-events-auto': visible,
      }
    "
    class="absolute top-0 left-0 w-full h-full lg:block hidden cursor-default bg-bone-tint/30 opacity-0 duration-300 ease-linear"
  ></button>
  <div
    x-cloak
    x-show="visible"
    x-transition:enter="duration-500 transition-transform ease-in-out transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end=""
    x-transition:leave="duration-500 transition-transform ease-in-out transform"
    x-transition:leave-start=""
    x-transition:leave-end="translate-x-full"
    :class="
      {
        'pointer-events-auto': visible,
      }
    "
    class="bg-bone-tint h-full md:h-screen w-full lg:w-[calc(100%+1rem)] shrink-0 lg:col-span-6 lg:col-start-[15] border-l border-current relative"
  >
    <div class="w-full h-full flex flex-col justify-between">
      {{ header }}
      <div
        ref="container"
        class="w-full h-full flex flex-col overflow-scroll no-scrollbar"
      >
        {{ items }}

        <div
          x-show="!hasItems"
          class="px-4 pt-4 flex items-start large-serif lg:medium-serif"
        >
          {{ section.settings.emptyBody }}
        </div>
        <div class="w-full grid grid-cols-6 gap-x-3 pr-4 pt-2 pb-16 shrink-0">
          <p class="small-accent uppercase pl-4 col-span-4">Subtotal</p>
          <p class="flex flex-col small-accent col-span-2">
            <span
              class="line-through opacity-50"
              x-show="totalPrice !== subtotalPrice"
              x-money="totalPrice"
            ></span>
            <span
              x-money="subtotalPrice"
            ></span>
          </p>
        </div>
      </div>
      <div
        class="sticky shrink-0 bottom-0 h-max w-full p-4 pt-0"
        x-show="hasItems"
      >
        {{ cartCheckout }}
      </div>
      <div class="hidden md:contents">
        <div
          class="sticky shrink-0 bottom-0 h-max w-full p-4"
          x-show="!hasItems"
        >
          <a
            href="{{ section.settings.emptyCTALink }}"
            aria-label="{{ section.settings.emptyCTAText }}"
            class="button"
          >
            {{ section.settings.emptyCTAText }}
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Cart",
  "class": "contents",
  "settings": [
    {
      "type": "header",
      "content": "Empty Cart"
    },
    {
      "type": "richtext",
      "id": "emptyBody",
      "label": "Empty Cart Message"
    },
    {
      "type": "text",
      "id": "emptyCTAText",
      "label": "Empty Cart CTA Text",
      "default": "Back to Shop"
    },
    {
      "type": "url",
      "id": "emptyCTALink",
      "label": "Empty Cart CTA Link",
      "default": "/collections/all"
    }
  ],
  "presets": [
    {
      "name": "Cart"
    }
  ]
}
{% endschema %}
