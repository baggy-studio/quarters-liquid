{% capture header %}
<div class="pt-6 md:pt-8 pb-6 flex items-end justify-between w-full relative">
  <p class="h7-jubilee md:h6-jubilee">
    Bag <span :class="$store.cart.hasItems ? 'contents' : 'hidden'">(<span class="contents" x-text="$store.cart.count">{{ cart.item_count }}</span>)</span>
  </p> 
  <button
    @click="$store.cart.close()"
    aria-label="Close bag"
    class="w-max h-max h7-jubilee md:text-[34px] font-jubilee leading-none"
  >
    x
  </button>
</div>
{% endcapture %}

{% capture items %}
<template x-for="(line, index) in $store.cart.cartLines" :key="line.key">
  {% render 'cart-line' %}
</template>
{% endcapture %}

{% capture cartCheckout %}
<div class="border-t-2 border-current flex flex-col gap-6 py-6">
  <div class="flex items-center justify-between">
    <p class="p2-souvenir">Subtotal</p>
    <p class="flex gap-1 font-futura text-[32px] font-bold tracking-[-0.05em]">
      <sup
        class="line-through top-2 leading-none text-[65%]"
        x-show="$store.cart.totalPrice !== $store.cart.subtotalPrice"
        x-money="$store.cart.totalPrice"
      ></sup>
      <span
        x-money="$store.cart.subtotalPrice"
        data-currency="{{ cart.currency.symbol }}"
      ></span>
    </p>
  </div>
  <a
    href="/checkout"
    aria-label="Checkout"
    rel="external"
    target="_blank"
    data-no-swup
    class="rounded-xl p1-futura flex items-center justify-center border-2 border-brown w-full h-[58px] duration-300 transition-colors hover:bg-brown hover:text-cream"
  >
    Check out
  </a>
</div>
{% endcapture %}

<script id="cart-data" type="application/json">
  {{ cart | json }}
</script>
<div
  class="fixed top-0 left-0 w-full h-full z-50 pointer-events-none"
  :class="!$store.cart.visible && 'pointer-events-none'"
  x-trap.inert.noscroll="$store.cart.visible"
>
  <button
    aria-label="Close cart"
    @click="$store.cart.close()"
    class="absolute top-0 left-0 w-full h-full cursor-default"
    x-cloak
    x-show="$store.cart.visible"
  ></button>
  <div
    x-cloak
    x-show="$store.cart.visible"
    x-transition:enter="duration-500 transition-transform ease-in-out transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end=""
    x-transition:leave="duration-500 transition-transform ease-in-out transform"
    x-transition:leave-start=""
    x-transition:leave-end="translate-x-full"
    class="bg-cream bg-texture absolute right-0 top-0 h-full md:h-screen w-full md:w-[623px]"
  >
    <div class="w-full h-full flex flex-col justify-between">
      <div class="w-full shrink-0 h-max flex flex-col px-5 md:px-9">
        {{ header }}
      </div>
      <div
        ref="container"
        class="w-full h-full flex flex-col overflow-scroll no-scrollbar"
      >
        {{ items }}
        <div
          x-show="!$store.cart.hasItems"
          class="text-center h3-jubilee pt-7 px-10 md:px-9 pb-12 md:pb-0"
        >
          {{ section.settings.emptyBody }}
        </div>
      </div>
      <div
        class="sticky shrink-0 bottom-0 h-max w-full px-5 md:px-9 duration-300"
        x-show="$store.cart.hasItems"
      >
        {{ cartCheckout }}
      </div>
      <div class="hidden md:contents">
        <div
          class="sticky shrink-0 bottom-0 h-max w-full duration-300 bg-bottom py-6 px-5 md:px-9"
          x-show="!$store.cart.hasItems"
        >
          <a
            href="{{ section.settings.emptyCTALink }}"
            aria-label="{{ section.settings.emptyCTAText }}"
            class="rounded-xl p1-futura flex items-center justify-center border-2 border-brown w-full h-[58px] duration-300 transition-colors hover:bg-brown hover:text-cream"
          >
            {{ section.settings.emptyCTAText }}
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<p x-data x-text="$store.cart.visible" id="cart-text">
   
</p>

{% schema %}
{
  "name": "Cart",
  "class": "contents",
  "settings": [
    {
      "type": "header",
      "content": "Empty Cart"
    },
    {
      "type": "richtext",
      "id": "emptyBody",
      "label": "Empty Cart Message"
    },
    {
      "type": "text",
      "id": "emptyCTAText",
      "label": "Empty Cart CTA Text",
      "default": "Back to Shop"
    },
    {
      "type": "url",
      "id": "emptyCTALink",
      "label": "Empty Cart CTA Link",
      "default": "/collections/all"
    }
  ],
  "presets": [
    {
      "name": "Cart"
    }
  ]
}
{% endschema %}
