<aside
  aria-modal
  role="dialog"
  @set-consent.window="shouldOpen"
  x-data="newsletter('{{ section.settings.listId }}', {{ section.settings.delay | default: 5 }})"
  
  class="absolute top-0 left-0 w-full bottom-0 flex items-end pointer-events-none z-50"
>
  <div
    :class="
      {
        'opacity-100': visible,
        'opacity-0': !visible
      }
    "
    data-newsletter
    class="bottom-4 sticky w-full lg:grid lg:grid-cols-20 px-4 gap-4 lg:gap-3 opacity-0 duration-300 ease-linear"
  >
    <div
      :class="
        {
          'pointer-events-auto': visible
        }
      "
      data-newsletter-content
      class="w-full flex flex-col text-mahogany bg-chartreuse border-current border lg:col-start-[16] lg:col-span-5 {% if section.settings.image %}h-auto{% else %}h-[160px]{% endif %} sm:max-w-[360px] lg:max-w-none overflow-hidden ml-auto"
    >
      {% if section.settings.image %}
        <div class="w-full relative pb-[100%] border-b border-current">
          {{ section.settings.image | image_url: width: 400 | image_tag: loading: 'lazy', class: 'absolute inset-0 w-full h-full object-cover' }}
        </div> 
      {% endif %}
      
      <div class="p-4 flex flex-col justify-between {% if section.settings.image %}min-h-[160px]{% else %}h-full{% endif %}">
        <div class="relative flex items-start justify-between gap-8 lg:gap-4 w-full">
          <div class="small-sans richtext {% if section.settings.image %}max-w-full{% else %}max-w-[290px]{% endif %}">
            {{ section.settings.content }}
          </div>
          <button @click="close" class="w-3.5 h-3.5 hover:opacity-50 duration-300 ease-linear transition-opacity shrink-0">
            <svg viewBox="0 0 14 14" fill="none">
              <path d="M1.00195 1L13.0002 13" stroke="#643600"/>
              <path d="M12.998 1L0.999804 13" stroke="#643600"/>
            </svg>
          </button>
        </div>
        {% render 'newsletter' %}
      </div>
    </div>
  </div>
</aside>

{% schema %}
{
  "name": "Newsletter",
  "class": "contents",
  "settings": [
    {
      "type": "richtext",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "text",
      "id": "listId",
      "label": "List Id",
      "info": "The Klaviyo List ID"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image (optional)"
    },
    {
      "type": "range",
      "id": "delay",
      "label": "Popup delay (seconds)",
      "min": 0,
      "max": 10,
      "step": 1,
      "default": 5,
      "info": "Time to wait before showing popup after cookie banner is closed. 0 = immediate."
    }
  ],
  "presets": [
    {
      "name": "Newsletter"
    }
  ]
}
{% endschema %}
